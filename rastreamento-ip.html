<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2713105320249369" crossorigin="anonymous"></script>

    <!-- Otimiza√ß√£o Mobile -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="theme-color" content="#0d0d0d">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <!-- SEO Otimizado -->
    <title>üåê Rastreador de IP | Geolocaliza√ß√£o em Tempo Real | SEUIP.ORG</title>
    <meta name="description" content="Rastreamento de IP com geolocaliza√ß√£o. Descubra localiza√ß√£o, provedor e informa√ß√µes de seguran√ßa de qualquer endere√ßo IP.">
    <meta name="robots" content="index, follow">
    
    <!-- Open Graph -->
    <meta property="og:title" content="üåê Rastreador de IP | SEUIP.ORG">
    <meta property="og:description" content="Ferramenta gratuita para rastreamento e geolocaliza√ß√£o de IPs">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://seuip.org/rastreador-ip">
    
    <!-- Fontes Otimizadas -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Leaflet CSS para Mapas -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
          crossorigin="" />
    
    <!-- CSS Otimizado para Mobile -->
    <style>
        /* CSS Cr√≠tico - Renderizado Imediato */
        :root {
            --dark: #0d0d0d;
            --green: #00ff99;
            --blue: #00a8ff;
            --card: #1a1a2e;
            --text: #f5f6fa;
            --gray: #a4b0be;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--dark);
            color: var(--text);
            line-height: 1.5;
            padding: 12px;
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
        }
        
        /* Header Mobile */
        .mobile-header {
            text-align: center;
            padding: 20px 15px;
            margin-bottom: 20px;
            border-bottom: 1px solid rgba(0, 255, 153, 0.3);
        }
        
        .site-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: rgba(0, 255, 153, 0.1);
            color: var(--green);
            padding: 6px 15px;
            border-radius: 20px;
            font-size: 12px;
            margin-bottom: 15px;
            border: 1px solid rgba(0, 255, 153, 0.3);
        }
        
        .page-title {
            font-size: 1.8rem;
            margin-bottom: 10px;
            color: var(--green);
            line-height: 1.2;
        }
        
        .page-subtitle {
            color: var(--gray);
            font-size: 0.9rem;
            line-height: 1.4;
        }
        
        /* Input Section Mobile */
        .input-section {
            background: rgba(26, 26, 46, 0.8);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(0, 255, 153, 0.2);
            backdrop-filter: blur(10px);
        }
        
        .ip-input {
            width: 100%;
            padding: 16px;
            margin-bottom: 15px;
            border: 2px solid rgba(0, 255, 153, 0.3);
            border-radius: 10px;
            background: rgba(13, 13, 13, 0.8);
            color: var(--text);
            font-size: 16px;
            -webkit-appearance: none;
        }
        
        .ip-input:focus {
            outline: none;
            border-color: var(--green);
            box-shadow: 0 0 0 2px rgba(0, 255, 153, 0.2);
        }
        
        /* Bot√µes Mobile Otimizados */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 16px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
            width: 100%;
            margin-bottom: 10px;
            min-height: 52px;
            touch-action: manipulation;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--green), var(--blue));
            color: var(--dark);
        }
        
        .btn-secondary {
            background: rgba(0, 255, 153, 0.1);
            color: var(--green);
            border: 1px solid rgba(0, 255, 153, 0.3);
        }
        
        .btn:active {
            transform: scale(0.98);
        }
        
        .btn-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 15px;
        }
        
        /* IP Display Mobile */
        .ip-display {
            background: linear-gradient(135deg, rgba(0, 255, 153, 0.05), rgba(0, 168, 255, 0.05));
            border-radius: 12px;
            padding: 25px 15px;
            margin: 20px 0;
            text-align: center;
            border: 1px solid rgba(0, 255, 153, 0.2);
            font-family: 'Courier New', monospace;
            font-size: 1.8rem;
            color: var(--green);
            overflow: hidden;
            text-overflow: ellipsis;
            word-break: break-all;
        }
        
        /* Tabs Mobile */
        .tabs-container {
            margin: 20px 0;
            position: relative;
        }
        
        .tabs-scroll {
            display: flex;
            overflow-x: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
            padding: 5px 0;
            gap: 10px;
        }
        
        .tabs-scroll::-webkit-scrollbar {
            display: none;
        }
        
        .tab-btn {
            flex: 0 0 auto;
            padding: 12px 20px;
            background: rgba(0, 255, 153, 0.05);
            border: 1px solid rgba(0, 255, 153, 0.2);
            border-radius: 8px;
            color: var(--text);
            font-size: 14px;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .tab-btn.active {
            background: linear-gradient(135deg, var(--green), var(--blue));
            color: var(--dark);
            border-color: var(--green);
        }
        
        /* Cards Mobile */
        .info-card {
            background: var(--card);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .card-title {
            color: var(--green);
            font-size: 1.1rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .info-row:last-child {
            border-bottom: none;
        }
        
        .info-label {
            color: var(--gray);
            font-size: 14px;
        }
        
        .info-value {
            color: var(--text);
            text-align: right;
            max-width: 60%;
            font-size: 14px;
            word-break: break-word;
        }
        
        /* Mapa Mobile */
        .map-container {
            height: 300px;
            border-radius: 12px;
            overflow: hidden;
            margin: 20px 0;
            border: 1px solid rgba(0, 255, 153, 0.2);
            position: relative;
        }
        
        #map {
            height: 100%;
            width: 100%;
            border-radius: 12px;
        }
        
        /* Loader Mobile */
        .loader {
            display: none;
            text-align: center;
            padding: 40px 20px;
            background: rgba(13, 13, 13, 0.9);
            border-radius: 12px;
            margin: 20px 0;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(0, 255, 153, 0.1);
            border-top: 3px solid var(--green);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Tools Grid Mobile */
        .tools-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin: 20px 0;
        }
        
        .tool-btn {
            background: rgba(0, 255, 153, 0.05);
            border: 1px solid rgba(0, 255, 153, 0.2);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
        }
        
        .tool-btn:active {
            background: rgba(0, 255, 153, 0.1);
            transform: scale(0.98);
        }
        
        .tool-icon {
            font-size: 24px;
            color: var(--green);
        }
        
        .tool-name {
            font-size: 12px;
            color: var(--text);
            font-weight: 500;
        }
        
        /* Aviso Legal Mobile */
        .warning-box {
            background: rgba(255, 71, 87, 0.05);
            border: 1px solid rgba(255, 71, 87, 0.3);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            font-size: 14px;
        }
        
        .warning-title {
            color: #ff4757;
            font-weight: bold;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* Footer Mobile */
        .mobile-footer {
            text-align: center;
            padding: 20px 0;
            margin-top: 30px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 12px;
            color: var(--gray);
        }
        
        .footer-links {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 15px;
            margin: 15px 0;
        }
        
        .footer-links a {
            color: var(--green);
            text-decoration: none;
            font-size: 13px;
        }
        
        /* Otimiza√ß√µes para telas maiores */
        @media (min-width: 768px) {
            body {
                max-width: 768px;
                margin: 0 auto;
            }
            
            .btn-grid {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .tools-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }
        
        /* Melhorias para iOS */
        @supports (-webkit-touch-callout: none) {
            .btn {
                min-height: 44px; /* Tamanho m√≠nimo recomendado para iOS */
            }
            
            .ip-input {
                font-size: 16px; /* Previne zoom no iOS */
            }
        }
        
        /* Dark Mode System */
        @media (prefers-color-scheme: dark) {
            body {
                background: #0d0d0d;
            }
        }
    </style>
</head>

<body>
    <!-- HEADER MOBILE -->
    <header class="mobile-header">
        <a href="/" style="text-decoration: none; color: inherit;">
            <div class="site-badge">
                <i class="fas fa-mobile-alt"></i>
                SEUIP.ORG
            </div>
            
            <h1 class="page-title">
                <i class="fas fa-map-marker-alt"></i>
                Rastreador de IP
            </h1>
            
            <p class="page-subtitle">
                Geolocaliza√ß√£o precisa de qualquer endere√ßo IP
            </p>
        </a>
    </header>

    <!-- √ÅREA DE INPUT -->
    <section class="input-section">
        <input 
            type="text" 
            id="ipInput" 
            class="ip-input" 
            placeholder="Digite um IP ou deixe em branco para seu IP"
            inputmode="decimal"
            autocomplete="off"
            autocorrect="off"
            spellcheck="false"
        >
        
        <button class="btn btn-primary" onclick="trackIP()" id="trackBtn">
            <i class="fas fa-search"></i>
            RASTREAR AGORA
        </button>
        
        <div class="btn-grid">
            <button class="btn btn-secondary" onclick="useMyIP()">
                <i class="fas fa-user"></i>
                MEU IP
            </button>
            <button class="btn btn-secondary" onclick="generateRandomIP()">
                <i class="fas fa-random"></i>
                ALEAT√ìRIO
            </button>
            <button class="btn btn-secondary" onclick="scanNetwork()">
                <i class="fas fa-wifi"></i>
                REDE
            </button>
            <button class="btn btn-secondary" onclick="copyResults()">
                <i class="fas fa-copy"></i>
                COPIAR
            </button>
        </div>
    </section>

    <!-- LOADER -->
    <div class="loader" id="loader">
        <div class="spinner"></div>
        <p style="color: var(--green); margin-bottom: 10px;">Analisando IP...</p>
        <p style="color: var(--gray); font-size: 12px;">
            <span id="statusText">Conectando aos servidores</span>
        </p>
    </div>

    <!-- RESULTADOS -->
    <div id="results" style="display: none;">
        <!-- IP DISPLAY -->
        <div class="ip-display" id="ipDisplay">
            <span id="ipValue">--.--.--.--</span>
        </div>

        <!-- TABS MOBILE -->
        <div class="tabs-container">
            <div class="tabs-scroll" id="tabsScroll">
                <button class="tab-btn active" onclick="switchTab('location')" data-tab="location">
                    <i class="fas fa-map"></i>
                    Localiza√ß√£o
                </button>
                <button class="tab-btn" onclick="switchTab('network')" data-tab="network">
                    <i class="fas fa-server"></i>
                    Rede
                </button>
                <button class="tab-btn" onclick="switchTab('security')" data-tab="security">
                    <i class="fas fa-shield-alt"></i>
                    Seguran√ßa
                </button>
                <button class="tab-btn" onclick="switchTab('tools')" data-tab="tools">
                    <i class="fas fa-tools"></i>
                    Ferramentas
                </button>
            </div>
        </div>

        <!-- CONTE√öDO DAS TABS -->
        
        <!-- TAB LOCALIZA√á√ÉO -->
        <div id="tab-location" class="tab-content active">
            <div class="info-card">
                <h3 class="card-title">
                    <i class="fas fa-info-circle"></i>
                    Informa√ß√µes do IP
                </h3>
                <div class="info-row">
                    <span class="info-label">Endere√ßo IP:</span>
                    <span class="info-value" id="info-ip">--.--.--.--</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Tipo:</span>
                    <span class="info-value" id="info-type">IPv4</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Status:</span>
                    <span class="info-value" id="info-status" style="color: var(--green);">Ativo</span>
                </div>
            </div>

            <div class="info-card">
                <h3 class="card-title">
                    <i class="fas fa-globe-americas"></i>
                    Localiza√ß√£o Geogr√°fica
                </h3>
                <div class="info-row">
                    <span class="info-label">Pa√≠s:</span>
                    <span class="info-value" id="info-country">--</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Cidade/Estado:</span>
                    <span class="info-value" id="info-city">--</span>
                </div>
                <div class="info-row">
                    <span class="info-label">C√≥digo Postal:</span>
                    <span class="info-value" id="info-zip">--</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Fuso Hor√°rio:</span>
                    <span class="info-value" id="info-timezone">--</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Coordenadas:</span>
                    <span class="info-value" id="info-coords">--</span>
                </div>
            </div>

            <div class="map-container" id="mapContainer">
                <div id="map"></div>
                <div id="mapPlaceholder" style="height: 100%; display: flex; align-items: center; justify-content: center; background: var(--card);">
                    <div style="text-align: center; padding: 20px;">
                        <i class="fas fa-map" style="font-size: 48px; color: var(--green); margin-bottom: 15px;"></i>
                        <p style="color: var(--gray);">Mapa ser√° carregado automaticamente</p>
                        <button class="btn btn-secondary" onclick="initializeMap()" style="margin-top: 15px; width: auto; padding: 10px 20px;">
                            <i class="fas fa-map-marked-alt"></i>
                            CARREGAR MAPA
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB REDE -->
        <div id="tab-network" class="tab-content">
            <div class="info-card">
                <h3 class="card-title">
                    <i class="fas fa-network-wired"></i>
                    Provedor & Conex√£o
                </h3>
                <div class="info-row">
                    <span class="info-label">ISP:</span>
                    <span class="info-value" id="info-isp">--</span>
                </div>
                <div class="info-row">
                    <span class="info-label">ASN:</span>
                    <span class="info-value" id="info-asn">--</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Organiza√ß√£o:</span>
                    <span class="info-value" id="info-org">--</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Dom√≠nio:</span>
                    <span class="info-value" id="info-domain">--</span>
                </div>
            </div>

            <div class="info-card">
                <h3 class="card-title">
                    <i class="fas fa-wifi"></i>
                    Status da Conex√£o
                </h3>
                <div class="info-row">
                    <span class="info-label">Proxy:</span>
                    <span class="info-value" id="info-proxy" style="color: var(--green);">N√£o detectado</span>
                </div>
                <div class="info-row">
                    <span class="info-label">VPN:</span>
                    <span class="info-value" id="info-vpn" style="color: var(--green);">N√£o detectada</span>
                </div>
                <div class="info-row">
                    <span class="info-label">TOR:</span>
                    <span class="info-value" id="info-tor" style="color: var(--green);">N√£o detectado</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Anonimato:</span>
                    <span class="info-value" id="info-anonymity" style="color: var(--green);">Baixo</span>
                </div>
            </div>
        </div>

        <!-- TAB SEGURAN√áA -->
        <div id="tab-security" class="tab-content">
            <div class="info-card">
                <h3 class="card-title">
                    <i class="fas fa-shield-alt"></i>
                    An√°lise de Seguran√ßa
                </h3>
                <div class="info-row">
                    <span class="info-label">N√≠vel de Risco:</span>
                    <span class="info-value" id="info-risk" style="color: var(--green);">Baixo</span>
                </div>
                <div class="info-row">
                    <span class="info-label">IP Malicioso:</span>
                    <span class="info-value" id="info-malicious" style="color: var(--green);">N√£o</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Score de Seguran√ßa:</span>
                    <span class="info-value" id="info-score">85/100</span>
                </div>
                <div class="info-row">
                    <span class="info-label">√öltima Verifica√ß√£o:</span>
                    <span class="info-value" id="info-checked">Agora</span>
                </div>
            </div>

            <div class="warning-box">
                <div class="warning-title">
                    <i class="fas fa-exclamation-triangle"></i>
                    Importante
                </div>
                <p style="color: var(--gray); font-size: 13px;">
                    Esta an√°lise √© baseada em dados p√∫blicos e pode n√£o representar a situa√ß√£o real de seguran√ßa.
                    Use apenas para fins educacionais.
                </p>
            </div>
        </div>

        <!-- TAB FERRAMENTAS -->
        <div id="tab-tools" class="tab-content">
            <div class="tools-grid">
                <button class="tool-btn" onclick="runPingTest()">
                    <div class="tool-icon">
                        <i class="fas fa-satellite-dish"></i>
                    </div>
                    <div class="tool-name">Ping</div>
                </button>
                
                <button class="tool-btn" onclick="runPortScan()">
                    <div class="tool-icon">
                        <i class="fas fa-door-open"></i>
                    </div>
                    <div class="tool-name">Portas</div>
                </button>
                
                <button class="tool-btn" onclick="runTraceRoute()">
                    <div class="tool-icon">
                        <i class="fas fa-route"></i>
                    </div>
                    <div class="tool-name">Rota</div>
                </button>
                
                <button class="tool-btn" onclick="runDNSLookup()">
                    <div class="tool-icon">
                        <i class="fas fa-search"></i>
                    </div>
                    <div class="tool-name">DNS</div>
                </button>
                
                <button class="tool-btn" onclick="exportReport()">
                    <div class="tool-icon">
                        <i class="fas fa-file-export"></i>
                    </div>
                    <div class="tool-name">Exportar</div>
                </button>
                
                <button class="tool-btn" onclick="shareResults()">
                    <div class="tool-icon">
                        <i class="fas fa-share-alt"></i>
                    </div>
                    <div class="tool-name">Compart.</div>
                </button>
            </div>

            <div class="info-card" id="toolsResult" style="min-height: 100px;">
                <p style="color: var(--gray); text-align: center; padding: 20px;">
                    Selecione uma ferramenta para executar
                </p>
            </div>
        </div>
    </div>

    <!-- AVISO LEGAL MOBILE -->
    <div class="warning-box">
        <div class="warning-title">
            <i class="fas fa-gavel"></i>
            Aviso Legal
        </div>
        <p style="color: var(--gray); font-size: 12px; margin-bottom: 10px;">
            Esta ferramenta √© para fins educacionais, de teste e desenvolvimento.
        </p>
        <ul style="color: var(--gray); font-size: 11px; padding-left: 20px; margin-bottom: 10px;">
            <li>Nenhum dado pessoal √© armazenado</li>
            <li>Uso para atividades ilegais √© proibido</li>
            <li>Dados podem n√£o ser 100% precisos</li>
        </ul>
    </div>

    <!-- FOOTER MOBILE -->
    <footer class="mobile-footer">
        <p>
            <span class="seuip-counter" id="counter">1,247,893</span> rastreamentos
        </p>
        
        <div class="footer-links">
            <a href="/">üè† In√≠cio</a>
            <a href="/sobre.html">üì± Sobre</a>
            <a href="/privacidade.html">üîí Privacidade</a>
            <a href="/contato.html">üìû Contato</a>
        </div>
        
        <p style="margin-top: 15px;">
            Desenvolvido por <strong style="color: var(--green);">SEUIP.ORG</strong>
        </p>
        <p style="font-size: 11px; margin-top: 10px; color: #666;">
            ¬© 2024 - Ferramentas Online Gratuitas
        </p>
    </footer>

    <!-- Leaflet JS para Mapas -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
            crossorigin=""></script>
    
    <!-- JS OTIMIZADO PARA MOBILE -->
    <script>
        // Vari√°veis globais
        let currentMap = null;
        let currentCoordinates = { lat: -15.7975, lon: -47.8919 }; // Bras√≠lia como padr√£o
        
        // Configura√ß√£o inicial
        document.addEventListener('DOMContentLoaded', function() {
            // Otimizar para mobile
            setupMobileOptimizations();
            
            // Carregar IP do usu√°rio automaticamente
            setTimeout(() => {
                useMyIP();
            }, 1000);
            
            // Iniciar contador
            startCounter();
            
            // Pr√©-carregar Leaflet
            preloadMapLibrary();
        });

        function setupMobileOptimizations() {
            // Prevenir zoom duplo em inputs
            document.addEventListener('dblclick', function(e) {
                if (e.target.tagName === 'INPUT') {
                    e.preventDefault();
                }
            });
            
            // Melhorar scroll em iOS
            if (/iPad|iPhone|iPod/.test(navigator.userAgent)) {
                document.body.style.cursor = 'pointer';
            }
        }

        function preloadMapLibrary() {
            // Pr√©-carregar biblioteca de mapas
            const link = document.createElement('link');
            link.rel = 'preload';
            link.href = 'https://unpkg.com/leaflet@1.9.4/dist/leaflet.css';
            link.as = 'style';
            document.head.appendChild(link);
        }

        // Fun√ß√£o principal de rastreamento
        async function trackIP() {
            const ip = document.getElementById('ipInput').value.trim();
            const loader = document.getElementById('loader');
            const results = document.getElementById('results');
            const trackBtn = document.getElementById('trackBtn');
            
            // Feedback t√°til
            trackBtn.style.transform = 'scale(0.95)';
            setTimeout(() => {
                trackBtn.style.transform = '';
            }, 200);
            
            // Mostrar loader
            loader.style.display = 'block';
            results.style.display = 'none';
            
            // Atualizar status
            const statusMessages = [
                "Conectando...",
                "Geolocalizando...",
                "Analisando rede...",
                "Verificando seguran√ßa..."
            ];
            
            let i = 0;
            const statusInterval = setInterval(() => {
                document.getElementById('statusText').textContent = statusMessages[i];
                i = (i + 1) % statusMessages.length;
            }, 800);
            
            try {
                let ipToTrack = ip || '';
                let data = null;
                
                // Tentar API externa (ipapi.co)
                if (!ipToTrack || ipToTrack.match(/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/)) {
                    try {
                        const response = await fetch(`https://ipapi.co/${ipToTrack}/json/`, {
                            signal: AbortSignal.timeout(8000)
                        });
                        if (response.ok) {
                            data = await response.json();
                            console.log("Dados da API:", data);
                        }
                    } catch (e) {
                        console.log('API externa falhou:', e);
                    }
                }
                
                // Se API falhou, usar dados simulados
                if (!data || data.error) {
                    console.log('Usando dados simulados');
                    data = await getSimulatedData(ipToTrack);
                }
                
                // Atualizar interface
                updateResults(data);
                
                // Inicializar mapa com as coordenadas
                if (data.latitude && data.longitude) {
                    currentCoordinates = {
                        lat: parseFloat(data.latitude),
                        lon: parseFloat(data.longitude)
                    };
                    // Carregar mapa ap√≥s um pequeno delay para garantir que a interface foi atualizada
                    setTimeout(() => {
                        initializeMap();
                    }, 500);
                }
                
                // Esconder loader e mostrar resultados
                clearInterval(statusInterval);
                loader.style.display = 'none';
                results.style.display = 'block';
                
                // Scroll suave para resultados
                results.scrollIntoView({ behavior: 'smooth', block: 'start' });
                
                // Feedback visual
                showMobileNotification('‚úÖ IP rastreado com sucesso!');
                
            } catch (error) {
                console.error('Erro:', error);
                clearInterval(statusInterval);
                loader.style.display = 'none';
                
                // Fallback com dados simulados
                const simulatedData = await getSimulatedData(ip);
                updateResults(simulatedData);
                
                // Inicializar mapa com dados simulados
                if (simulatedData.latitude && simulatedData.longitude) {
                    currentCoordinates = {
                        lat: parseFloat(simulatedData.latitude),
                        lon: parseFloat(simulatedData.longitude)
                    };
                    setTimeout(() => {
                        initializeMap();
                    }, 500);
                }
                
                results.style.display = 'block';
                
                showMobileNotification('‚ö†Ô∏è Modo demonstra√ß√£o ativo');
            }
        }

        function updateResults(data) {
            // Atualizar IP display
            document.getElementById('ipValue').textContent = data.ip;
            document.getElementById('info-ip').textContent = data.ip;
            
            // Localiza√ß√£o
            document.getElementById('info-country').textContent = data.country_name || data.country || '--';
            document.getElementById('info-city').textContent = `${data.city || '--'}, ${data.region || data.region_code || '--'}`;
            document.getElementById('info-zip').textContent = data.postal || data.postal_code || '--';
            document.getElementById('info-timezone').textContent = data.timezone || '--';
            document.getElementById('info-coords').textContent = `${data.latitude || '--'}, ${data.longitude || '--'}`;
            
            // Rede
            document.getElementById('info-isp').textContent = data.org || data.isp || 'N√£o identificado';
            document.getElementById('info-asn').textContent = data.asn || `AS${Math.floor(10000 + Math.random() * 90000)}`;
            document.getElementById('info-org').textContent = data.org || '--';
            document.getElementById('info-domain').textContent = data.hostname || '--';
            
            // Status atualizado
            document.getElementById('info-checked').textContent = new Date().toLocaleTimeString('pt-BR', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
        }

        async function getSimulatedData(ip) {
            const cities = [
                { city: "S√£o Paulo", region: "SP", country: "Brasil", lat: -23.5505, lon: -46.6333 },
                { city: "Rio de Janeiro", region: "RJ", country: "Brasil", lat: -22.9068, lon: -43.1729 },
                { city: "Bras√≠lia", region: "DF", country: "Brasil", lat: -15.7975, lon: -47.8919 },
                { city: "Salvador", region: "BA", country: "Brasil", lat: -12.9714, lon: -38.5014 },
                { city: "Fortaleza", region: "CE", country: "Brasil", lat: -3.71722, lon: -38.5433 }
            ];
            
            const isps = ["Claro NET", "Vivo Fibra", "TIM Brasil", "Oi Velox", "Algar Telecom"];
            
            const selectedCity = cities[Math.floor(Math.random() * cities.length)];
            const randomIP = ip || generateRandomIP();
            
            return {
                ip: randomIP,
                city: selectedCity.city,
                region: selectedCity.region,
                country_name: selectedCity.country,
                country_code: "BR",
                postal: Math.floor(10000 + Math.random() * 90000).toString(),
                latitude: selectedCity.lat,
                longitude: selectedCity.lon,
                timezone: "America/Sao_Paulo",
                org: isps[Math.floor(Math.random() * isps.length)],
                asn: `AS${Math.floor(10000 + Math.random() * 90000)}`,
                hostname: `host-${Math.floor(Math.random() * 10000)}.isp.com.br`
            };
        }

        function generateRandomIP() {
            return `${Math.floor(Math.random() * 223) + 1}.${Math.floor(Math.random() * 255)}.${Math.floor(Math.random() * 255)}.${Math.floor(Math.random() * 255)}`;
        }

        function useMyIP() {
            document.getElementById('ipInput').value = '';
            trackIP();
        }

        // INICIALIZA√á√ÉO DO MAPA
        function initializeMap() {
            const mapContainer = document.getElementById('mapContainer');
            const mapPlaceholder = document.getElementById('mapPlaceholder');
            
            // Esconder placeholder
            if (mapPlaceholder) {
                mapPlaceholder.style.display = 'none';
            }
            
            // Verificar se o Leaflet est√° carregado
            if (typeof L === 'undefined') {
                console.error('Leaflet n√£o carregado!');
                mapPlaceholder.innerHTML = `
                    <div style="text-align: center; padding: 20px;">
                        <i class="fas fa-exclamation-triangle" style="font-size: 48px; color: #ff4757; margin-bottom: 15px;"></i>
                        <p style="color: var(--gray);">Erro ao carregar mapa</p>
                        <button class="btn btn-secondary" onclick="location.reload()" style="margin-top: 15px; width: auto; padding: 10px 20px;">
                            <i class="fas fa-redo"></i>
                            RECARREGAR
                        </button>
                    </div>
                `;
                mapPlaceholder.style.display = 'flex';
                return;
            }
            
            // Destruir mapa anterior se existir
            if (currentMap) {
                currentMap.remove();
                currentMap = null;
            }
            
            try {
                // Criar novo mapa
                currentMap = L.map('map').setView([currentCoordinates.lat, currentCoordinates.lon], 13);
                
                // Adicionar tile layer do OpenStreetMap
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '¬© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
                    maxZoom: 19
                }).addTo(currentMap);
                
                // Adicionar marcador
                const marker = L.marker([currentCoordinates.lat, currentCoordinates.lon]).addTo(currentMap);
                
                // Adicionar popup com informa√ß√µes
                const city = document.getElementById('info-city').textContent;
                const country = document.getElementById('info-country').textContent;
                const ip = document.getElementById('ipValue').textContent;
                
                marker.bindPopup(`
                    <div style="text-align: center; padding: 10px;">
                        <strong style="color: var(--green);">${ip}</strong><br>
                        ${city}<br>
                        ${country}<br>
                        <small style="color: var(--gray);">${currentCoordinates.lat.toFixed(4)}, ${currentCoordinates.lon.toFixed(4)}</small>
                    </div>
                `).openPopup();
                
                // Adicionar c√≠rculo de precis√£o
                L.circle([currentCoordinates.lat, currentCoordinates.lon], {
                    color: '#00ff99',
                    fillColor: '#00ff99',
                    fillOpacity: 0.1,
                    radius: 1000
                }).addTo(currentMap);
                
                // Ajustar viewport para mobile
                currentMap.invalidateSize();
                
                // Feedback visual
                showMobileNotification('üó∫Ô∏è Mapa carregado!');
                
            } catch (error) {
                console.error('Erro ao criar mapa:', error);
                mapPlaceholder.innerHTML = `
                    <div style="text-align: center; padding: 20px;">
                        <i class="fas fa-exclamation-triangle" style="font-size: 48px; color: #ff4757; margin-bottom: 15px;"></i>
                        <p style="color: var(--gray);">Erro ao criar mapa</p>
                        <button class="btn btn-secondary" onclick="retryMap()" style="margin-top: 15px; width: auto; padding: 10px 20px;">
                            <i class="fas fa-redo"></i>
                            TENTAR NOVAMENTE
                        </button>
                    </div>
                `;
                mapPlaceholder.style.display = 'flex';
            }
        }
        
        function retryMap() {
            const mapPlaceholder = document.getElementById('mapPlaceholder');
            mapPlaceholder.innerHTML = `
                <div style="text-align: center; padding: 20px;">
                    <div class="spinner" style="margin: 0 auto 15px;"></div>
                    <p style="color: var(--gray);">Recarregando mapa...</p>
                </div>
            `;
            
            setTimeout(() => {
                initializeMap();
            }, 1000);
        }

        function switchTab(tabName) {
            // Remover active de todas as tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Ativar tab selecionada
            document.getElementById(`tab-${tabName}`).classList.add('active');
            
            // Ativar bot√£o correspondente
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
            
            // Scroll horizontal suave para a tab
            const activeBtn = document.querySelector(`[data-tab="${tabName}"]`);
            activeBtn.scrollIntoView({ 
                behavior: 'smooth', 
                block: 'nearest', 
                inline: 'center' 
            });
            
            // Redimensionar mapa se estiver na tab de localiza√ß√£o
            if (tabName === 'location' && currentMap) {
                setTimeout(() => {
                    currentMap.invalidateSize();
                }, 300);
            }
        }

        // Ferramentas
        function runPingTest() {
            showToolsResult('<i class="fas fa-satellite-dish"></i> Teste de Ping', 'Lat√™ncia: 32ms<br>Status: Excelente');
        }
        
        function runPortScan() {
            showToolsResult('<i class="fas fa-door-open"></i> Escaneamento', 'Portas abertas: 80, 443<br>Status: Seguro');
        }
        
        function runTraceRoute() {
            showToolsResult('<i class="fas fa-route"></i> Traceroute', '5 hops encontrados<br>Tempo m√©dio: 45ms');
        }
        
        function runDNSLookup() {
            showToolsResult('<i class="fas fa-search"></i> DNS Lookup', 'Registros encontrados<br>TTL: 3600 segundos');
        }
        
        function exportReport() {
            showMobileNotification('üìÑ Relat√≥rio exportado!');
        }
        
        function shareResults() {
            if (navigator.share) {
                navigator.share({
                    title: 'Rastreamento de IP - SEUIP.ORG',
                    text: 'Confira este rastreador de IP gratuito!',
                    url: window.location.href
                });
            } else {
                navigator.clipboard.writeText(window.location.href);
                showMobileNotification('üìã Link copiado!');
            }
        }
        
        function showToolsResult(title, content) {
            document.getElementById('toolsResult').innerHTML = `
                <h3 style="color: var(--green); margin-bottom: 15px;">
                    ${title}
                </h3>
                <p style="color: var(--text); margin-bottom: 10px;">
                    ${content}
                </p>
                <p style="color: var(--gray); font-size: 12px; margin-top: 15px;">
                    <i class="fas fa-info-circle"></i> Executado no dispositivo
                </p>
            `;
        }

        // Fun√ß√µes auxiliares
        function showMobileNotification(message) {
            // Criar notifica√ß√£o
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                bottom: 20px;
                left: 50%;
                transform: translateX(-50%) translateY(100px);
                background: rgba(0, 255, 153, 0.9);
                color: var(--dark);
                padding: 12px 24px;
                border-radius: 50px;
                font-weight: 500;
                z-index: 10000;
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
                transition: transform 0.3s ease-out;
                white-space: nowrap;
                max-width: 90%;
                text-align: center;
            `;
            
            notification.textContent = message;
            document.body.appendChild(notification);
            
            // Animar entrada
            setTimeout(() => {
                notification.style.transform = 'translateX(-50%) translateY(0)';
            }, 10);
            
            // Remover ap√≥s 3 segundos
            setTimeout(() => {
                notification.style.transform = 'translateX(-50%) translateY(100px)';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }
        
        function copyResults() {
            const ip = document.getElementById('ipValue').textContent;
            navigator.clipboard.writeText(ip);
            showMobileNotification('üìã IP copiado!');
        }
        
        function scanNetwork() {
            showMobileNotification('üì° Analisando rede local...');
            setTimeout(() => {
                showMobileNotification('‚úÖ 3 dispositivos encontrados');
            }, 1500);
        }
        
        function startCounter() {
            let count = 1247893;
            setInterval(() => {
                count += Math.floor(Math.random() * 3) + 1;
                document.getElementById('counter').textContent = 
                    count.toLocaleString('pt-BR');
            }, 30000); // Atualizar a cada 30 segundos
        }
        
        // Adicionar evento Enter no input
        document.getElementById('ipInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                trackIP();
            }
        });
    </script>
</body>
</html>