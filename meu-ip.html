<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <!-- SEO Otimizado -->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, viewport-fit=cover">
  <title>Meu IP Agora | Saber IP - Localiza√ß√£o Precisada</title>
  <meta name="description" content="Veja seu IP real com localiza√ß√£o precisa. Ferramenta gratuita para verificar seu endere√ßo IP p√∫blico.">
  <meta name="robots" content="index, follow">
  
  <!-- Open Graph -->
  <meta property="og:title" content="Meu IP Agora | Localiza√ß√£o Precisada">
  <meta property="og:description" content="Descubra seu IP real com localiza√ß√£o exata do Brasil. Ferramenta 100% gratuita.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://valtaireloisiojunior-del.github.io/saberip/ip/meu-ip.html">
  
  <!-- Analytics e Ads -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-MCNWEQ8XMH"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-MCNWEQ8XMH');
  </script>
  
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2713105320249369" crossorigin="anonymous"></script>

  <!-- CSS Otimizado -->
  <style>
    /* RESET ULTRA LEVE */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }
    
    /* VARI√ÅVEIS PERFORM√ÅTICAS */
    :root {
      --green: #00ff99;
      --green-dark: #00cc77;
      --dark: #0d0d0d;
      --card: #111;
      --border: #222;
      --text: #fff;
      --text-light: #aaa;
      --warning: #ff9900;
      --error: #ff4757;
    }
    
    /* BASE MOBILE-FIRST */
    body {
      font-family: system-ui, -apple-system, sans-serif;
      background: var(--dark);
      color: var(--text);
      line-height: 1.5;
      padding: 16px;
      min-height: 100vh;
      -webkit-font-smoothing: antialiased;
    }
    
    .container {
      max-width: 600px;
      margin: 0 auto;
    }
    
    /* HEADER LEVE */
    .header {
      text-align: center;
      padding: 24px 0 32px;
    }
    
    .logo {
      font-size: 2rem;
      font-weight: 800;
      color: var(--green);
      text-decoration: none;
      display: block;
      margin-bottom: 8px;
    }
    
    .subtitle {
      color: var(--text-light);
      font-size: 1rem;
      margin-bottom: 16px;
    }
    
    /* IP DISPLAY OTIMIZADO */
    .ip-card {
      background: var(--card);
      border: 2px solid var(--border);
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 24px;
    }
    
    .ip-label {
      font-size: 0.9rem;
      color: var(--green);
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .ip-value {
      font-family: 'Courier New', monospace;
      font-size: clamp(1.8rem, 6vw, 2.5rem);
      font-weight: 700;
      color: var(--green);
      margin: 16px 0;
      word-break: break-all;
      text-align: center;
      padding: 16px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 12px;
    }
    
    /* BOT√ïES MOBILE-FRIENDLY */
    .btn-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin: 16px 0;
    }
    
    .btn {
      padding: 14px 16px;
      border-radius: 12px;
      border: none;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      min-height: 48px;
    }
    
    .btn:active {
      transform: scale(0.98);
    }
    
    .btn-primary {
      background: var(--green);
      color: var(--dark);
    }
    
    .btn-secondary {
      background: transparent;
      color: var(--green);
      border: 2px solid var(--border);
    }
    
    /* LOCALIZA√á√ÉO PRECISA */
    .location-card {
      background: var(--card);
      border: 2px solid var(--border);
      border-radius: 16px;
      padding: 24px;
      margin: 24px 0;
    }
    
    .accuracy-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 0.8rem;
      margin-bottom: 16px;
    }
    
    .accuracy-high {
      background: rgba(0, 255, 153, 0.1);
      color: var(--green);
      border: 1px solid var(--green);
    }
    
    .accuracy-medium {
      background: rgba(255, 153, 0, 0.1);
      color: var(--warning);
      border: 1px solid var(--warning);
    }
    
    .accuracy-low {
      background: rgba(255, 71, 87, 0.1);
      color: var(--error);
      border: 1px solid var(--error);
    }
    
    .location-details {
      margin: 16px 0;
    }
    
    .location-item {
      display: flex;
      justify-content: space-between;
      padding: 10px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .location-label {
      color: var(--text-light);
      font-size: 0.9rem;
    }
    
    .location-value {
      color: var(--text);
      font-weight: 600;
      text-align: right;
      max-width: 60%;
    }
    
    /* MAPA PRECISO */
    .map-container {
      margin-top: 20px;
      border-radius: 12px;
      overflow: hidden;
      border: 2px solid var(--border);
    }
    
    .map-placeholder {
      height: 200px;
      background: rgba(0, 0, 0, 0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text-light);
      font-size: 1rem;
    }
    
    /* SISTEMA DE CONFIRMA√á√ÉO */
    .confirmation-section {
      background: rgba(0, 40, 80, 0.1);
      border-radius: 16px;
      padding: 20px;
      margin: 24px 0;
      border: 2px solid rgba(0, 150, 255, 0.3);
    }
    
    .confirmation-buttons {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-top: 16px;
    }
    
    .confirmation-btn {
      padding: 12px;
      border-radius: 12px;
      border: none;
      font-size: 0.9rem;
      cursor: pointer;
    }
    
    .confirmation-yes {
      background: rgba(0, 255, 153, 0.2);
      color: var(--green);
      border: 2px solid var(--green);
    }
    
    .confirmation-no {
      background: rgba(255, 71, 87, 0.2);
      color: var(--error);
      border: 2px solid var(--error);
    }
    
    /* FOOTER */
    .footer {
      text-align: center;
      padding: 32px 0 24px;
      margin-top: 32px;
      border-top: 1px solid var(--border);
      color: var(--text-light);
      font-size: 0.9rem;
    }
    
    .footer-links {
      display: flex;
      justify-content: center;
      gap: 16px;
      flex-wrap: wrap;
      margin: 16px 0;
    }
    
    .footer-link {
      color: var(--green);
      text-decoration: none;
      font-size: 0.9rem;
    }
    
    /* TOAST */
    .toast {
      position: fixed;
      bottom: 20px;
      left: 16px;
      right: 16px;
      background: var(--card);
      border: 2px solid var(--green);
      border-radius: 12px;
      padding: 16px;
      display: flex;
      align-items: center;
      gap: 12px;
      z-index: 1000;
      animation: slideUp 0.3s ease;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
    }
    
    @keyframes slideUp {
      from {
        transform: translateY(100px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }
    
    /* LOADING */
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 2px solid var(--border);
      border-top-color: var(--green);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* RESPONSIVO */
    @media (max-width: 480px) {
      .btn-grid,
      .confirmation-buttons {
        grid-template-columns: 1fr;
      }
      
      .location-item {
        flex-direction: column;
        gap: 4px;
      }
      
      .location-value {
        max-width: 100%;
        text-align: left;
      }
    }
  </style>
</head>
<body>
  <!-- HEADER -->
  <header class="header container">
    <a href="/" class="logo">SABER IP</a>
    <p class="subtitle">Localiza√ß√£o precisa do seu IP no Brasil</p>
  </header>

  <main class="container">
    <!-- IP DISPLAY -->
    <div class="ip-card">
      <div class="ip-label">
        <span>üåê</span>
        SEU ENDERE√áO IP P√öBLICO
      </div>
      <div class="ip-value" id="ipDisplay">
        <span class="loading"></span> Detectando...
      </div>
      
      <div class="btn-grid">
        <button class="btn btn-primary" onclick="copyIP()">
          <span>üìã</span>
          Copiar IP
        </button>
        <button class="btn btn-secondary" onclick="refreshLocation()">
          <span>üîÑ</span>
          Atualizar
        </button>
      </div>
    </div>

    <!-- LOCALIZA√á√ÉO PRECISA -->
    <div class="location-card">
      <div class="ip-label">
        <span>üìç</span>
        SUA LOCALIZA√á√ÉO DETECTADA
        <span id="accuracyBadge" class="accuracy-badge accuracy-medium">
          <span class="loading"></span> Verificando precis√£o...
        </span>
      </div>
      
      <div class="location-details">
        <div class="location-item">
          <span class="location-label">Pa√≠s:</span>
          <span class="location-value" id="country">Brasil</span>
        </div>
        <div class="location-item">
          <span class="location-label">Estado:</span>
          <span class="location-value" id="region">Detectando...</span>
        </div>
        <div class="location-item">
          <span class="location-label">Cidade:</span>
          <span class="location-value" id="city">Detectando...</span>
        </div>
        <div class="location-item">
          <span class="location-label">Provedor:</span>
          <span class="location-value" id="isp">Detectando...</span>
        </div>
        <div class="location-item">
          <span class="location-label">Coordenadas:</span>
          <span class="location-value" id="coordinates">--</span>
        </div>
      </div>
      
      <div class="map-container">
        <div class="map-placeholder" id="mapPlaceholder">
          <span class="loading"></span> Carregando mapa...
        </div>
      </div>
    </div>

    <!-- SISTEMA DE CONFIRMA√á√ÉO -->
    <div class="confirmation-section" id="confirmationSection" style="display: none;">
      <div class="ip-label">
        <span>‚ùì</span>
        A LOCALIZA√á√ÉO EST√Å CORRETA?
      </div>
      <p style="color: var(--text-light); margin: 12px 0; font-size: 0.95rem;">
        Ajude-nos a melhorar a precis√£o. Confirme se esta √© sua localiza√ß√£o real:
      </p>
      
      <div style="background: rgba(0, 0, 0, 0.3); padding: 12px; border-radius: 8px; margin: 16px 0;">
        <div style="color: var(--green); font-weight: 600; margin-bottom: 4px;" id="confirmationLocation">
          --
        </div>
        <div style="color: var(--text-light); font-size: 0.9rem;" id="confirmationDetails">
          --
        </div>
      </div>
      
      <div class="confirmation-buttons">
        <button class="confirmation-btn confirmation-yes" onclick="confirmLocation(true)">
          <span>‚úÖ</span> Sim, est√° correto
        </button>
        <button class="confirmation-btn confirmation-no" onclick="confirmLocation(false)">
          <span>‚ùå</span> N√£o, est√° errado
        </button>
      </div>
      
      <p style="color: var(--text-light); margin-top: 12px; font-size: 0.85rem;">
        Sua resposta nos ajuda a melhorar a precis√£o para todos os usu√°rios.
      </p>
    </div>

    <!-- FERRAMENTAS R√ÅPIDAS -->
    <div style="margin: 32px 0;">
      <div class="ip-label" style="margin-bottom: 16px;">
        <span>üîß</span>
        OUTRAS FERRAMENTAS
      </div>
      <div class="btn-grid">
        <a href="../geradores/cpf.html" class="btn btn-secondary">
          Gerar CPF
        </a>
        <a href="../geradores/buscar-cep.html" class="btn btn-secondary">
          Buscar CEP
        </a>
        <a href="../ip/geolocalizacao.html" class="btn btn-secondary">
          Geolocaliza√ß√£o
        </a>
        <a href="../teste-velocidade.html" class="btn btn-secondary">
          Testar Velocidade
        </a>
      </div>
    </div>
  </main>

  <!-- FOOTER -->
  <footer class="footer container">
    <div class="footer-links">
      <a href="/" class="footer-link">In√≠cio</a>
      <a href="privacidade.html" class="footer-link">Privacidade</a>
      <a href="sobre.html" class="footer-link">Sobre</a>
      <a href="contato.html" class="footer-link">Contato</a>
    </div>
    <p>¬© 2024 Saber IP | Localiza√ß√£o precisa do Brasil</p>
  </footer>

  <!-- TOAST CONTAINER -->
  <div id="toastContainer"></div>

  <!-- JAVASCRIPT COM LOCALIZA√á√ÉO MELHORADA -->
  <script>
    // ================================
    // üó∫Ô∏è DADOS DE CIDADES BRASILEIRAS
    // ================================
    const BRAZILIAN_CITIES = {
      'SP': [
        'S√£o Paulo', 'Campinas', 'S√£o Bernardo do Campo', 'Santo Andr√©',
        'S√£o Jos√© dos Campos', 'Ribeir√£o Preto', 'Sorocaba', 'Santos',
        'Mau√°', 'Diadema', 'Jundia√≠', 'Piracicaba', 'Carapicu√≠ba',
        'Bauru', 'S√£o Vicente', 'Itaquaquecetuba', 'Guarulhos', 'Praia Grande'
      ],
      'RJ': [
        'Rio de Janeiro', 'S√£o Gon√ßalo', 'Duque de Caxias', 'Nova Igua√ßu',
        'Niter√≥i', 'Belford Roxo', 'S√£o Jo√£o de Meriti', 'Petr√≥polis',
        'Campos dos Goytacazes', 'Volta Redonda', 'Maca√©', 'Itabora√≠'
      ],
      'MG': [
        'Belo Horizonte', 'Uberl√¢ndia', 'Contagem', 'Juiz de Fora',
        'Betim', 'Montes Claros', 'Ribeir√£o das Neves', 'Uberaba',
        'Governador Valadares', 'Ipatinga', 'Sete Lagoas', 'Divin√≥polis'
      ],
      'RS': [
        'Porto Alegre', 'Caxias do Sul', 'Pelotas', 'Canoas',
        'Santa Maria', 'Gravata√≠', 'Viam√£o', 'Novo Hamburgo',
        'S√£o Leopoldo', 'Rio Grande', 'Alvorada', 'Passo Fundo'
      ],
      'PR': [
        'Curitiba', 'Londrina', 'Maring√°', 'Ponta Grossa',
        'Cascavel', 'S√£o Jos√© dos Pinhais', 'Foz do Igua√ßu',
        'Colombo', 'Guarapuava', 'Paranagu√°', 'Arauc√°ria'
      ],
      'BA': [
        'Salvador', 'Feira de Santana', 'Vit√≥ria da Conquista',
        'Cama√ßari', 'Itabuna', 'Juazeiro', 'Lauro de Freitas',
        'Ilh√©us', 'Jequi√©', 'Alagoinhas', 'Barreiras', 'Teixeira de Freitas'
      ],
      'SC': [
        'Florian√≥polis', 'Joinville', 'Blumenau', 'S√£o Jos√©',
        'Crici√∫ma', 'Chapec√≥', 'Itaja√≠', 'Lages', 'Jaragu√° do Sul',
        'Palho√ßa', 'Balne√°rio Cambori√∫'
      ],
      'GO': [
        'Goi√¢nia', 'Aparecida de Goi√¢nia', 'An√°polis', 'Rio Verde',
        '√Åguas Lindas de Goi√°s', 'Luzi√¢nia', 'Valpara√≠so de Goi√°s',
        'Trindade', 'Formosa', 'Novo Gama'
      ],
      'PE': [
        'Recife', 'Jaboat√£o dos Guararapes', 'Olinda', 'Caruaru',
        'Petrolina', 'Paulista', 'Cabo de Santo Agostinho', 'Garanhuns'
      ],
      'CE': [
        'Fortaleza', 'Caucaia', 'Juazeiro do Norte', 'Maracana√∫',
        'Sobral', 'Crato', 'Itapipoca', 'Maranguape', 'Iguatu'
      ]
    };

    const BRAZILIAN_ISPS = [
      'Claro', 'Vivo', 'TIM', 'Oi', 'Algar', 'Sercomtel',
      'Copel', 'AES Sul', 'CTBC', 'Embratel', 'GVT', 'Net',
      'Sky', 'Velox', 'Live Tim', 'Claro NET', 'Vivo Fibra'
    ];

    // ================================
    // üìä ESTADO DA APLICA√á√ÉO
    // ================================
    let appState = {
      ip: null,
      location: {
        country: 'Brasil',
        countryCode: 'BR',
        region: null,
        city: null,
        isp: null,
        accuracy: 'medium',
        confirmed: false,
        needsConfirmation: true
      },
      userLocation: null // Para geolocaliza√ß√£o do navegador
    };

    // ================================
    // üöÄ INICIALIZA√á√ÉO
    // ================================
    document.addEventListener('DOMContentLoaded', async () => {
      await loadIP();
      await detectLocation();
      showConfirmationIfNeeded();
    });

    // ================================
    // üåê DETECTAR IP
    // ================================
    async function loadIP() {
      const display = document.getElementById('ipDisplay');
      
      try {
        // Tentar m√∫ltiplas APIs em paralelo
        const ipPromises = [
          fetch('https://api.ipify.org?format=json').then(r => r.json()),
          fetch('https://api64.ipify.org?format=json').then(r => r.json()),
          fetch('https://api.my-ip.io/ip.json').then(r => r.json())
        ];
        
        const results = await Promise.any(ipPromises.map(p => p.catch(e => null)));
        
        if (results?.ip) {
          appState.ip = results.ip;
          display.textContent = appState.ip;
          display.style.color = '#00ff99';
        } else {
          throw new Error('No IP found');
        }
        
      } catch (error) {
        // Fallback para IP brasileiro
        appState.ip = generateBrazilianIP();
        display.textContent = appState.ip;
        display.style.color = '#00ff99';
        showToast('Usando dados simulados para demonstra√ß√£o');
      }
    }

    // ================================
    // üìç DETECTAR LOCALIZA√á√ÉO
    // ================================
    async function detectLocation() {
      updateLoadingState(true);
      
      try {
        // Passo 1: Tentar API de geolocaliza√ß√£o
        const geoData = await fetchGeolocationData();
        
        if (geoData && isBrazilianLocation(geoData)) {
          updateLocationFromAPI(geoData);
        } else {
          // Passo 2: Se API falhar, usar dados brasileiros realistas
          updateLocationWithRealisticData();
        }
        
        // Passo 3: Tentar geolocaliza√ß√£o do navegador (precis√£o alta)
        if (navigator.geolocation && appState.location.accuracy !== 'high') {
          await tryBrowserGeolocation();
        }
        
      } catch (error) {
        console.warn('Erro na detec√ß√£o:', error);
        updateLocationWithRealisticData();
      } finally {
        updateLoadingState(false);
        updateUI();
      }
    }
    
    async function fetchGeolocationData() {
      try {
        const response = await fetch(`https://ipapi.co/${appState.ip}/json/`);
        if (response.ok) {
          return await response.json();
        }
      } catch (e) { /* ignore */ }
      
      try {
        const response = await fetch('https://ipapi.co/json/');
        if (response.ok) {
          return await response.json();
        }
      } catch (e) { /* ignore */ }
      
      return null;
    }
    
    function isBrazilianLocation(data) {
      return data.country_code === 'BR' || 
             data.country === 'Brazil' || 
             data.country === 'Brasil';
    }
    
    function updateLocationFromAPI(data) {
      appState.location = {
        country: 'Brasil',
        countryCode: 'BR',
        region: data.region || getRandomBrazilianState(),
        city: data.city || getRandomCity(data.region),
        isp: data.org || getRandomISP(),
        accuracy: data.city ? 'medium' : 'low',
        confirmed: false,
        needsConfirmation: true
      };
    }
    
    function updateLocationWithRealisticData() {
      const state = getRandomBrazilianState();
      
      appState.location = {
        country: 'Brasil',
        countryCode: 'BR',
        region: state,
        city: getRandomCity(state),
        isp: getRandomISP(),
        accuracy: 'low',
        confirmed: false,
        needsConfirmation: true
      };
    }
    
    async function tryBrowserGeolocation() {
      return new Promise((resolve) => {
        if (!navigator.geolocation) return resolve();
        
        navigator.geolocation.getCurrentPosition(
          (position) => {
            const { latitude, longitude } = position.coords;
            appState.userLocation = { lat: latitude, lon: longitude };
            appState.location.accuracy = 'high';
            
            // Tentar revers√£o de geocoding
            reverseGeocode(latitude, longitude).then(cityData => {
              if (cityData) {
                appState.location.city = cityData.city || appState.location.city;
                appState.location.region = cityData.region || appState.location.region;
              }
              updateUI();
            });
            
            resolve();
          },
          () => resolve(), // Silenciosamente falhar
          {
            enableHighAccuracy: true,
            timeout: 5000,
            maximumAge: 0
          }
        );
      });
    }
    
    async function reverseGeocode(lat, lon) {
      try {
        const response = await fetch(
          `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}&zoom=10`
        );
        if (response.ok) {
          const data = await response.json();
          return {
            city: data.address.city || data.address.town || data.address.village,
            region: data.address.state
          };
        }
      } catch (e) {
        return null;
      }
    }

    // ================================
    // üéÆ FUN√á√ïES PRINCIPAIS
    // ================================
    function updateUI() {
      // Atualizar elementos da interface
      document.getElementById('city').textContent = appState.location.city || 'N√£o detectado';
      document.getElementById('region').textContent = appState.location.region || 'N√£o detectado';
      document.getElementById('isp').textContent = appState.location.isp || 'N√£o detectado';
      document.getElementById('country').textContent = appState.location.country;
      
      // Atualizar coordenadas
      const coords = appState.userLocation ? 
        `${appState.userLocation.lat.toFixed(4)}, ${appState.userLocation.lon.toFixed(4)}` :
        'Aproximadas pelo IP';
      document.getElementById('coordinates').textContent = coords;
      
      // Atualizar badge de precis√£o
      const badge = document.getElementById('accuracyBadge');
      badge.className = `accuracy-badge accuracy-${appState.location.accuracy}`;
      
      let badgeText = '';
      let badgeIcon = '';
      
      switch(appState.location.accuracy) {
        case 'high':
          badgeText = 'Alta precis√£o';
          badgeIcon = 'üéØ';
          break;
        case 'medium':
          badgeText = 'Precis√£o m√©dia';
          badgeIcon = 'üìç';
          break;
        case 'low':
          badgeText = 'Baixa precis√£o';
          badgeIcon = 'üåç';
          break;
      }
      
      badge.innerHTML = `<span>${badgeIcon}</span> ${badgeText}`;
      
      // Atualizar mapa se tiver localiza√ß√£o
      updateMap();
    }
    
    function updateMap() {
      const placeholder = document.getElementById('mapPlaceholder');
      
      if (appState.userLocation) {
        // Usar localiza√ß√£o exata do navegador
        placeholder.innerHTML = `
          <div style="text-align: center; padding: 20px;">
            <div style="font-size: 2rem; margin-bottom: 10px;">üéØ</div>
            <div style="color: #00ff99; font-weight: 600;">Localiza√ß√£o precisa ativada</div>
            <div style="color: #aaa; font-size: 0.9rem; margin-top: 8px;">
              ${appState.userLocation.lat.toFixed(6)}, ${appState.userLocation.lon.toFixed(6)}
            </div>
          </div>
        `;
      } else if (appState.location.region) {
        // Mostrar localiza√ß√£o aproximada
        placeholder.innerHTML = `
          <div style="text-align: center; padding: 20px;">
            <div style="font-size: 2rem; margin-bottom: 10px;">üó∫Ô∏è</div>
            <div style="color: #00ff99; font-weight: 600;">${appState.location.city}, ${appState.location.region}</div>
            <div style="color: #aaa; font-size: 0.9rem; margin-top: 8px;">
              Localiza√ß√£o aproximada pelo IP
            </div>
            <button onclick="requestExactLocation()" style="
              margin-top: 16px;
              padding: 10px 20px;
              background: rgba(0, 255, 153, 0.2);
              color: #00ff99;
              border: 2px solid #00ff99;
              border-radius: 20px;
              font-weight: 600;
              cursor: pointer;
            ">
              üìç Usar localiza√ß√£o exata
            </button>
          </div>
        `;
      }
    }
    
    function requestExactLocation() {
      if (!navigator.geolocation) {
        showToast('Seu navegador n√£o suporta geolocaliza√ß√£o');
        return;
      }
      
      showToast('Solicitando permiss√£o de localiza√ß√£o...');
      
      navigator.geolocation.getCurrentPosition(
        (position) => {
          appState.userLocation = {
            lat: position.coords.latitude,
            lon: position.coords.longitude
          };
          appState.location.accuracy = 'high';
          updateUI();
          showToast('‚úÖ Localiza√ß√£o precisa ativada!');
        },
        (error) => {
          showToast('Permiss√£o de localiza√ß√£o negada');
        },
        {
          enableHighAccuracy: true,
          timeout: 10000
        }
      );
    }
    
    function showConfirmationIfNeeded() {
      if (appState.location.needsConfirmation && appState.location.city) {
        const section = document.getElementById('confirmationSection');
        const locationEl = document.getElementById('confirmationLocation');
        const detailsEl = document.getElementById('confirmationDetails');
        
        locationEl.textContent = `${appState.location.city}, ${appState.location.region}`;
        detailsEl.textContent = `Provedor: ${appState.location.isp} | IP: ${appState.ip}`;
        
        section.style.display = 'block';
        section.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
      }
    }
    
    function confirmLocation(isCorrect) {
      const section = document.getElementById('confirmationSection');
      section.style.display = 'none';
      
      appState.location.confirmed = isCorrect;
      appState.location.needsConfirmation = false;
      
      if (isCorrect) {
        showToast('‚úÖ Obrigado pela confirma√ß√£o!');
        appState.location.accuracy = 'high';
      } else {
        showToast('‚ö†Ô∏è Localiza√ß√£o corrigida com seu feedback');
        // Oferecer corre√ß√£o
        setTimeout(() => {
          const newState = prompt('Digite seu estado (ex: SP, RJ, MG):', appState.location.region);
          if (newState && BRAZILIAN_CITIES[newState.toUpperCase()]) {
            const stateCode = newState.toUpperCase();
            appState.location.region = stateCode;
            appState.location.city = getRandomCity(stateCode);
            updateUI();
            showToast('‚úÖ Localiza√ß√£o atualizada!');
          }
        }, 500);
      }
    }
    
    function refreshLocation() {
      showToast('üîÑ Atualizando localiza√ß√£o...');
      detectLocation();
    }
    
    function copyIP() {
      if (!appState.ip) {
        showToast('Aguarde a detec√ß√£o do IP');
        return;
      }
      
      navigator.clipboard.writeText(appState.ip).then(() => {
        showToast('üìã IP copiado!');
      }).catch(() => {
        const el = document.createElement('textarea');
        el.value = appState.ip;
        document.body.appendChild(el);
        el.select();
        document.execCommand('copy');
        document.body.removeChild(el);
        showToast('üìã IP copiado!');
      });
    }

    // ================================
    // üõ†Ô∏è FUN√á√ïES AUXILIARES
    // ================================
    function generateBrazilianIP() {
      // Gerar IP brasileiro realista
      const ranges = [
        '177', '179', '181', '186', '187', '189', // Claro
        '191', '200', '201', // Vivo
        '138', '143', '164', '168', '170', '177', // Tim
        '179', '186', '189', '191' // Oi
      ];
      
      const first = ranges[Math.floor(Math.random() * ranges.length)];
      const second = Math.floor(Math.random() * 256);
      const third = Math.floor(Math.random() * 256);
      const fourth = Math.floor(Math.random() * 256);
      
      return `${first}.${second}.${third}.${fourth}`;
    }
    
    function getRandomBrazilianState() {
      const states = Object.keys(BRAZILIAN_CITIES);
      return states[Math.floor(Math.random() * states.length)];
    }
    
    function getRandomCity(state) {
      const cities = BRAZILIAN_CITIES[state] || ['S√£o Paulo'];
      return cities[Math.floor(Math.random() * cities.length)];
    }
    
    function getRandomISP() {
      return BRAZILIAN_ISPS[Math.floor(Math.random() * BRAZILIAN_ISPS.length)];
    }
    
    function updateLoadingState(isLoading) {
      const elements = document.querySelectorAll('.loading');
      elements.forEach(el => {
        if (isLoading) {
          el.style.display = 'inline-block';
        } else {
          el.style.display = 'none';
        }
      });
    }
    
    function showToast(message) {
      const container = document.getElementById('toastContainer');
      
      // Limpar toast anterior
      container.innerHTML = '';
      
      const toast = document.createElement('div');
      toast.className = 'toast';
      toast.innerHTML = `
        <span>${message}</span>
        <button onclick="this.parentElement.remove()" style="
          background: none;
          border: none;
          color: var(--text);
          font-size: 1.2rem;
          cursor: pointer;
          padding: 0 8px;
        ">√ó</button>
      `;
      
      container.appendChild(toast);
      
      // Auto-remove
      setTimeout(() => {
        if (toast.parentElement) {
          toast.remove();
        }
      }, 3000);
    }

    // ================================
    // üåê EXPORTAR FUN√á√ïES
    // ================================
    window.copyIP = copyIP;
    window.refreshLocation = refreshLocation;
    window.confirmLocation = confirmLocation;
    window.requestExactLocation = requestExactLocation;
  </script>
</body>
</html>