<!-- üìú INCLUIR QR CODE.JS -->
<script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>

<script>
// ============================================
// ‚ö° FUN√á√ÉO ATUALIZADA DE GERAR QR CODE
// ============================================
function generateQRCode() {
  const canvas = document.getElementById('qrcodeCanvas');
  const loading = document.getElementById('qrLoading');
  const qrInfo = document.getElementById('qrInfo');
  const qrActions = document.getElementById('qrActions');
  
  let qrData = '';
  let qrType = '';
  
  switch(currentType) {
    case 'url':
      qrData = document.getElementById('input-url').value.trim();
      qrType = 'URL';
      if (!qrData) { showToast('‚ùå Digite uma URL v√°lida!', 'error'); return; }
      if (!qrData.startsWith('http')) qrData = 'https://' + qrData;
      break;
    case 'wifi':
      const ssid = document.getElementById('wifi-ssid').value.trim();
      const password = document.getElementById('wifi-password').value.trim();
      const security = document.getElementById('wifi-security').value;
      const wifiType = document.getElementById('wifi-type').value;
      if (!ssid) { showToast('‚ùå Digite o nome da rede Wi-Fi!', 'error'); return; }
      qrData = `WIFI:S:${ssid};T:${security};P:${password};H:${wifiType==='WIFI_HIDDEN'?'true':'false'};;`;
      qrType = 'Wi-Fi';
      break;
    case 'whatsapp':
      const number = document.getElementById('whatsapp-number').value.replace(/\D/g, '');
      const message = document.getElementById('whatsapp-message').value.trim();
      if (!number || number.length<10) { showToast('‚ùå Digite um n√∫mero v√°lido!', 'error'); return; }
      qrData = `https://wa.me/55${number}` + (message ? `?text=${encodeURIComponent(message)}` : '');
      qrType = 'WhatsApp';
      break;
    case 'contact':
      const name = document.getElementById('contact-name').value.trim();
      const phone = document.getElementById('contact-phone').value.trim();
      const email = document.getElementById('contact-email').value.trim();
      const company = document.getElementById('contact-company').value.trim();
      if (!name) { showToast('‚ùå Digite um nome para o contato!', 'error'); return; }
      qrData = `BEGIN:VCARD\nVERSION:3.0\nFN:${name}`;
      if(phone) qrData += `\nTEL:${phone}`;
      if(email) qrData += `\nEMAIL:${email}`;
      if(company) qrData += `\nORG:${company}`;
      qrData += '\nEND:VCARD';
      qrType = 'Contato';
      break;
    case 'text':
      qrData = document.getElementById('input-text').value.trim();
      qrType = 'Texto';
      if(!qrData){ showToast('‚ùå Digite algum texto!', 'error'); return; }
      break;
    case 'email':
      const to = document.getElementById('email-to').value.trim();
      const subject = document.getElementById('email-subject').value.trim();
      const body = document.getElementById('email-body').value.trim();
      if(!to){ showToast('‚ùå Digite um e-mail destino!', 'error'); return; }
      qrData = `mailto:${to}`;
      if(subject || body){
        const params = [];
        if(subject) params.push(`subject=${encodeURIComponent(subject)}`);
        if(body) params.push(`body=${encodeURIComponent(body)}`);
        qrData += '?' + params.join('&');
      }
      qrType = 'E-mail';
      break;
  }
  
  const size = parseInt(document.getElementById('qr-size').value);
  const color = document.getElementById('qr-color').value;
  const bgColor = document.getElementById('qr-bgcolor').value;
  const margin = parseInt(document.getElementById('qr-margin').value);
  
  loading.style.display = 'flex';
  canvas.style.display = 'none';
  
  // Limpa o canvas
  const ctx = canvas.getContext('2d');
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // Gera QR Code usando QRCode.js
  QRCode.toCanvas(canvas, qrData, {
    width: size,
    color: { dark: color, light: bgColor },
    margin: margin
  }, function (error) {
    if (error) {
      showToast('‚ùå Erro ao gerar QR Code!', 'error');
      console.error(error);
      loading.style.display = 'none';
      return;
    }

    currentQRCode = canvas;
    lastGeneratedData = qrData;

    // Atualiza contador
    generatedCount++;
    localStorage.setItem('qrGeneratedCount', generatedCount.toString());
    updateCounter();

    // Atualiza informa√ß√µes
    document.getElementById('infoType').textContent = qrType;
    document.getElementById('infoSize').textContent = `${size}x${size} px`;
    document.getElementById('infoTime').textContent = new Date().toLocaleTimeString('pt-BR');
    document.getElementById('infoChars').textContent = qrData.length;

    loading.style.display = 'none';
    canvas.style.display = 'block';
    qrInfo.style.display = 'block';
    qrActions.style.display = 'grid';

    showToast('‚úÖ QR Code gerado com sucesso!', 'success');
  });
}

// ============================================
// üîÑ LIMPAR FORMUL√ÅRIO
// ============================================
function resetForm() {
  document.querySelectorAll('.form-input, .form-textarea').forEach(el => el.value='');
  document.querySelectorAll('.form-select').forEach(el => el.selectedIndex=0);
  const canvas = document.getElementById('qrcodeCanvas');
  const ctx = canvas.getContext('2d');
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  document.getElementById('qrInfo').style.display='none';
  document.getElementById('qrActions').style.display='none';
  showToast('üîÑ Formul√°rio limpo!', 'info');
}

// ============================================
// üîß TOAST SIMPLES
// ============================================
function showToast(msg, type='info') {
  const container = document.getElementById('toastContainer');
  const toast = document.createElement('div');
  toast.className = 'toast show';
  toast.textContent = msg;
  container.appendChild(toast);
  setTimeout(()=>{ toast.remove(); }, 3500);
}
</script>
